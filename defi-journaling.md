# Looking for a bootstrapping point

Pancakeswap help finding the best deal for each pair with these medium. The first three are turned on by default, as you can see it is available for testnet too.

```javascript
// used to construct intermediary pairs for trading
export const BASES_TO_CHECK_TRADES_AGAINST: ChainTokenList = {
  [ChainId.MAINNET]: [
    mainnetTokens.wbnb,
    mainnetTokens.cake,
    mainnetTokens.busd,
    mainnetTokens.usdt,
    mainnetTokens.btcb,
    mainnetTokens.ust,
    mainnetTokens.eth,
    mainnetTokens.usdc,
  ],
  [ChainId.TESTNET]: [
    testnetTokens.wbnb,
    testnetTokens.cake,
    testnetTokens.busd,
  ],
};
```

`Currency` get wrapped to become a `Token`

see details of token: src/config/constants/tokens.ts

these common pairs will be combined with input PAIR (called "current pair") to have all necessary pairs.

- current pair: A-B
- common to-pair: wbnb, cake, busd
  -> combined pairs: [A-cake], [B-cake] -> [A-B] / cake
  see: src/hooks/Trades.ts

then dapp will retrieve reserve of these pair

get pair address show NO CLUE ON DENOMINATOR(cake / wbnb / busd) !?!?
**UPDATE**:

```
:app-lore these pair address is paired to common pairs, not direct pairs. Price of the direct pair, which is known as the "Trade" will be computed later, there is no direct reserve of direct pair in the protocol here: src/entities/pair.ts
```

execution price is calculated with the help of route

There is more than one LP for each pair, and the LP is the one that is used to compute the execution price.

There is more than one contract called 'Pancake-LP', which include

**Wrapped BNB-Binance USD**
0x58F876857a02D6762E0101bb5C46A8c1ED44Dc16
**PancakeSwap Token-Binance USD**
0x804678fa97d91B974ec2af3c843270886528a9E6

---

# "Don't call it a roadmap"

- Finish the mutlicall data in pcs price tracker, (currently at transform data) âœ…
- Found the fetch chunk method of multicall. (TODO: findout what multicall is really about) âœ…
  **UPDATE**:

```
:app-lore multicall is https://github.com/makerdao/multicall/blob/master/src/Multicall.sol
:app-lore aggregating logic of multicall happen at blockchain layer, not at frontend layer
```

- Solve the riddle when aggregating data from multiple contracts, reserve is now retrieved without no callkey in it, find a way to map it to proper callkey âœ…
- Find out if we need chunked calls (frequently) âœ…
  **UPDATE**:

```
:feature-decide callMultipleContractForSingleData is now implemented without chunking calls. most function is now async as expected
```

- Adjust CallState to meet the need of a cli âœ…

- Make POLS-BUSD pairs works! âœ…
- Make the cli work in testnet environment (might have to reimplement the pancakeswap-sdk :-ss) âœ…
- Decide how to switch between testnet and mainnet and then cleaning up the mess of today before moving on âœ…
  **UPDATE**:

```
:private-thought Solve halfway of this, now getReserves can be fetched from multicall contract. Have one answer on StackOverflow.
:feature-decide Done with env input and both test/main fetch data well if have data pool.
:feature-decide Code is now cleaned up and ready to be further developed
```

- Take out book and pen and decide where to go next? a hackbot that goes underground or some tool for peers to use? each approach will require different workload. Find out what you really want to do with this project. âœ…
  **UPDATE**:

```
I have finalized my decision to go with having a cli product. Whereas it might be tedious and hard to get regconition or profit, it is a good way to educate on atom-level component of defi protocol and the work can be easily shared and collaborated. I hope at the end of this pet project, I can reuse 50% of them to move on my adventure.
```

- Approve feature: âœ…
  **UPDATE**:

```
Providers (whether it is RPC or MetaMask) have its own managed list of accounts and it is set out of context of dApp. Within this cli, we will not use that but instead use a wallet generated by mnemonic.
```

- Approve method in test network differently in 2 nets, make both ready in the code. This is actually cool because the code is always there and money follow different rule âœ…
  **UPDATE**:

```
Turn out it is just one. Please do the research more carefully nexttime gru gru.
```

- Wrap feature âœ…
  **UPDATE**:

```
:feature-decide This feature is needed for the swap from BNB (only money available from testnet) to WBNB.
:app-lore currencyEquals method will return false even when address is the same of token. Things have to match exactly.
:private-thought testnet seem congested today, hmmm.. More time for me on reddit
:app-lore the WETH from pancake-sdk is not the one I have been looking for. That WETH has no deposit method, shishhh <- gonna address this tmr
:private-thought Imma call it a day, switching my interest to other things...
:private-thought I am back trying to finish the wrap function though, feel like I am not maxing out yet
:feature-decide wrap function works now, but the unwrap is untested as I planned to close my deal swap feature next

```

- Swap feature âœ…
  **UPDATE**:

```
:private-thought It been a while since I last put my effort in this pet project, let's restart with this :muscle
:feature-decide No ENS-resolving nor explitcitly set recipient will be implemented for simplicity.
:app-lore In the trade-exact-in case, the swap handle in FE is designed to have many set of params, which is then get estimated gas to check if it is possible to swap. presumably only one of each will get accepted by the blockchain. This is not self-verified yet, that explain why at the create callSwapArgs we have an array of swap-params which go through estimation and picked later. Ref: https://github.com/pancakeswap/pancake-frontend/blob/master/src/hooks/useSwapCallback.ts#L75. The option without onFeeTransfer is preferred because it give user better price of the trade but the latter is still used as a fallback transaction.

:app-lore based on the code behind, the swap can be conducted and send to a differenet user! this might help in the case of paying debt with saved fee.

:feature-decide beside get gas balance, I also need to get input token balance and throw an error if my balance is not enough.
:app-lore the change of provider from delegated Metamask to a self-managed RPC provider really bring about lots of work. For e.g, one does not simply call estimate gas here in this cli :eyeroll:\
:feature-decide for consistency all method that need to paygas will use callwith gasprice, the knowledge here is enough to write an article on how to call contract methods !??!
```

- Token balance feature âœ…
  **UPDATE**:

```
:feature-decide This feature is needed for the swap feature to work well.
:app-lore The native token can not use method BalanceOf like every other token, it uses getEthBalance (obviously a fork :eyeroll) to get the balance. This also explain why we need to have to wrap the BNB or ETH or FTM to conduct swapping.

:feature-decide Should I make a wrapper for BNB or ETH or FTM? -> yes

```

- Read and understand the new code pasted (bestTradeSoFar, tradeExactIn) âœ…
  **UPDATE**:

```
I will revisit this code when needed, it seem pointless trying to scramp everything without having a clear goal for it.
This should be next to find out why 2-way trading is not equivalent.

:app-lore MAX_HOP times is number of successive trades allow to happen to make a single transaction happen. This help wiring to bigger liquidity but increase transaction fee.

:feature-decide tradeComparator might need tweaking -> not yet done

:app-lore Too big of a margin is because of getOutputAmount and getInputAmount of Pair entity give 2 different results, while the expectation is to be equal -> the reason is because of low reserve in 2 pools and DEFI swap require buyer to accept the price calculated after the impact is applied, not before. I have created a tweet explaining this: https://twitter.com/phamhuyphat/status/1476141052486557698

```

- Staking tracker feature ðŸš§
- Find my first staking method and get the number of CAKE staked
  **UPDATE**:

```
- :app-lore BSC now have this error causing error when decoding input data https://github.com/ChainSafe/web3.js/pull/3948
- :feature-decide use abi-decoder to avoid problem mentioned above
- :app-lore CoinGecko does have NodeJs client but it seem outmaintained. Open a new issue today and stand by for reply: https://github.com/miscavage/CoinGecko-API/issues/33
- :app-lore trying to understand log in transaction lead me to basic theory of keccak hashing: https://en.wikipedia.org/wiki/SHA-3 , https://medium.com/mycrypto/-  -understanding-event-logs-on-the-ethereum-blockchain-f4ae7ba50378
- :feature-decide three pools is now set, finishing touch is otw
- :app-lore `enterStaking` and `leaveStaking` with `PancakeSwap Main Staking Contract: 0x73feaa1eE314F8c655E354234017bE2193C9E24E` is set fixed as poolInfo[0] - the CAKE pool. `deposit` or `withdraw` is used with dynamic params, which is used for IFO event such as pool 374 or 386(HOTCROSS LP)

- :app-lore removeLiquidityETH is the function to get CAKE token out of IFO and claim the reward. Reference: https://bscscan.com/tx/0xfd3bbc4bbbfbefd00ef28f4e4cf5624312c309ea3764bd9a6f921c1261de22ab , use this for liquidity-related features

```

## Trying to land a 3K jobs

- Pancakeswap use streaming fast to query token price compared to BNB values. fetch derived price: https://github-coolcorexix/pancakeswap/pancake-frontend/blob/master/src/state/swap/fetch/fetchDerivedPriceData.ts#L78
- In the case of price of direct pair, use a graphql client (bitquery service). fetch pair price: https://github-coolcorexix/pancakeswap/pancake-frontend/blob/master/src/state/swap/fetch/fetchPairPriceData.ts#L20
- The app try to calculate price base on liquidity of the direct pool but if it has not enough liquidity it tried to calculate based on BNB price of each token. https://github-coolcorexix/pancakeswap/pancake-frontend/blob/master/src/state/swap/fetch/utils.ts#L32
- data is usually cached, if not fetchAndUpdatePairPrice will be triggered https://github-coolcorexix/pancakeswap/pancake-frontend/blob/master/src/state/swap/hooks.ts#L384
- search Icon name in the storybook of ui-kit, start it with `yarn workspace @pancakeswap/uikit start `